vars:
  env_vars: "{{ plugin('load_os_vars') }}"
  filtered_vars: |
    {% set result = [] %}
    {% for key, value in env_vars.items() %}
      {% if key in ['PATH', 'USER', 'HOME', 'SHELL', 'USERNAME', 'USERPROFILE'] %}
        {% if key == 'PATH' %}
          {% set formatted_value = value[:80] + '...' if value|length > 80 else value %}
        {% else %}
          {% set formatted_value = value %}
        {% endif %}
        {% set _ = result.append({'variable': key, 'value': formatted_value}) %}
      {% endif %}
    {% endfor %}
    {{ result }}

stdout: "{{ env_vars }}"