secrets:
  - git_token

sources:
  git_token:
    env: git_token
  projects:
    shell: |
      gitlab_api_url=http://local-gitlab/api/v4
      git_token={{ lookup("env","git_token") }}
      lookup="projects"

      curl -s -k -X GET "${gitlab_api_url}/projects" \
          -H "Content-Type: application/json" \
          -H "PRIVATE-TOKEN: ${git_token}"


vars:
  queryset:
    path: "{}"
    select:
      - as: name
        expr: name
      - as: url
        expr: ssh_url_to_repo
      - as: created_at
        expr: created_at
      - as: last_activity_at
        expr: last_activity_at
  
# stdout: "{{ projects  }}" 
stdout: "{{ projects | from_json | jtable(queryset=queryset) }}" 